<html>
  <head>
    <title>Doople</title>
    <meta charset="utf-8" />
    <style type="text/css">
      body {
        text-align: center;
        min-width: 500px;
      }
    </style>
    <script src="import_js/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        // var host = $("#host").val();
        // var port = $("#port").val();
        // var uri = $("#uri").val();

        var ws;
        var host = 'localhost'
        var port = '8899'
        var uri = '/ws'
        var myID = 10

        ws = new WebSocket("ws://" + host + ":" + port + uri);

        ws.onmessage = function(evt) {
          // alert("message received: " + evt.data)
          var res = JSON.parse(evt.data)
          alert(res.method)
        };

        ws.onclose = function(evt) {
          // alert("Connection close");
        };

        ws.onopen = function(evt) {
          $("#host").css("background", "#00ff00");
          $("#port").css("background", "#00ff00");
          $("#uri").css("background", "#00ff00");
        };

        $("#send").click(function(evt) {
          evt.preventDefault();
          var message = {}
          message.method = 'helloworld'
          var json = JSON.stringify(message)
          ws.send(json)
        });

        // Calling a function based on a string variable
        // var target = 'next';
        // $("foobar")[target]();
        // Vanilla
        // window["functionName"](arguments);
        // window["My"]["Namespace"]["functionName"](arguments);

        // Decorated:
        // function executeFunctionByName(functionName, context /*, args */) {
        //   var args = Array.prototype.slice.call(arguments, 2);
        //   var namespaces = functionName.split(".");
        //   var func = namespaces.pop();
        //   for (var i = 0; i < namespaces.length; i++) {
        //     context = context[namespaces[i]];
        //   }
        //   return context[func].apply(context, args);
        // }
        // Called with:
        // executeFunctionByName("My.Namespace.functionName", window, arguments);
        // or
        // executeFunctionByName("Namespace.functionName", My, arguments);

      });
    </script>
  </head>

  <body>
    <h1>Doople</h1>
    <div>
      <label>method:</label>
      <input type="text" id="method"/><br />
      <label>params:</label>
      <input type="text" id="params"/><br />
      <label>id:</label>
      <input type="text" id="id"/><br />
      <input type="submit" id="send" value="send" />

      <!-- <label for="host">host:</label>
      <input type="text" id="host" value="localhost" style="background:#ff0000;"/><br />
      <label for="port">port:</label>
      <input type="text" id="port" value="8899" style="background:#ff0000;"/><br />
      <label for="uri">uri:</label>
      <input type="text" id="uri" value="/ws" style="background:#ff0000;"/><br />
      <input type="submit" id="open" value="open" /> -->
    </div>
  </body>
</html>

<!--
var sock;
var id = 0;
function init() {
    sock = new WebSocket('ws://localhost:6800/jsonrpc');
    sock.onopen = function() {
        var i;
        console.log('opened');
    };
    sock.onclose = function() {
        console.log('closed');
    };
    sock.onerror = function() {
        console.log('error');
    };
    sock.onmessage = function(message) {
        var res = JSON.parse(message.data);
        console.log('incoming message');
        console.log(res);
        console.log(JSON.stringify(res, undefined, 4));
    };
}

function getId()
{
    return String(++id);
}

function getReqTemplate()
{
    return {
        'jsonrpc':'2.0', 'id':getId()
    };
}

function send(req)
{
    sock.send(JSON.stringify(req));
}

function getVersion()
{
    var req = getReqTemplate();
    req['method'] = 'aria2.getVersion';
    send(req);
}
-->
